<script>
(async function () {
  const asin = "B0FNNBLF8G";

  const map = {
    "US": "https://www.amazon.com/dp/" + asin,
    "GB": "https://www.amazon.co.uk/dp/" + asin,
    "DE": "https://www.amazon.de/dp/" + asin,
    "FR": "https://www.amazon.fr/dp/" + asin,
    "IT": "https://www.amazon.it/dp/" + asin,
    "ES": "https://www.amazon.es/dp/" + asin,
    "NL": "https://www.amazon.nl/dp/" + asin,
    "SE": "https://www.amazon.se/dp/" + asin,
    "PL": "https://www.amazon.pl/dp/" + asin,
    "BE": "https://www.amazon.com.be/dp/" + asin,
    "CA": "https://www.amazon.ca/dp/" + asin,
    "AU": "https://www.amazon.com.au/dp/" + asin,
    "JP": "https://www.amazon.co.jp/dp/" + asin,
    "MX": "https://www.amazon.com.mx/dp/" + asin,
    "DEFAULT": "https://www.amazon.com/dp/" + asin
  };

  const params = new URLSearchParams(location.search);
  const debug = params.has("debug");
  const override = params.get("store");

  function go(url) {
    if (debug) {
      const p = document.createElement("p");
      p.textContent = "Redirecting to: " + url;
      document.body.appendChild(p);
      console.log("Redirecting to", url);
    }
    setTimeout(function () { location.replace(url); }, debug ? 1200 : 200);
  }

  // Manual override, e.g. ?store=se
  if (override) {
    const toCC = {
      "us": "US","uk": "GB","gb": "GB","de": "DE","fr": "FR","it": "IT","es": "ES","nl": "NL",
      "se": "SE","pl": "PL","be": "BE","ca": "CA","au": "AU","jp": "JP","mx": "MX"
    }[override.toLowerCase()];
    return go(map[toCC] || map.DEFAULT);
  }

  // Try IP-based geolocation first
  try {
    // Free, no key, CORS-enabled
    const res = await fetch("https://ipwho.is/?fields=country_code");
    const data = await res.json();
    if (data && data.country_code && map[data.country_code]) {
      return go(map[data.country_code]);
    }
  } catch (e) {
    if (debug) console.log("IP lookup failed", e);
  }

  // Fallback to browser language
  const lang = (navigator.language || "en-US").toUpperCase();
  const cc = lang.split("-")[1] || "US";
  return go(map[cc] || map.DEFAULT);
})();
</script>
